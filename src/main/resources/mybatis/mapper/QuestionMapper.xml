<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ooad.demo.mapper.QuestionMapper">

    <cache/>

    <select id="queryQuestionList" resultType="Question">
    select * from question
    </select>

    <select id="getDDL" resultType="java.sql.Timestamp">

    </select>

    <select id="getStandardAns" resultType="Question">
    select *
    from question q
    where q.question_id = ${question_id};
--     join assignment a on q.question_of_assignment = a.assignment_id;
    </select>

    <select id="selectQuestionById" resultType="Question">
    select question_id, question_name,
    question_of_assignment, question_description,
    question_output, question_index from question where question_id = #{question_id}
    </select>

    <insert id="addQuestion" parameterType="Question">
    insert into question(question_name, question_of_assignment, question_description, question_output, question_index)
    values (#{question_name}, #{question_of_assignment},#{question_description}, #{question_output}, #{question_index})
    </insert>


    <update id="updateQuestion" parameterType="Question">

    </update>

    <delete id="deleteQuestion" parameterType="int">
        delete from question
        where question_id = #{id}
    </delete>

    <select id="selectQuestionsByAssignment" resultType="Question">
    select  distinct q.question_id, q.question_name,
            q.question_of_assignment, q.question_description,
            
            q.question_output, q.question_index,
        case
            when r.record_status is null then 0
            when r.record_status = -1 then 0
            else 1 end
            as is_finished
    from
        question q left outer join record r on q.question_id = r.record_question_id and record_sid = #{sid} and record_status = 1
    where  q.question_of_assignment = #{assignment_id};
    </select>


</mapper>